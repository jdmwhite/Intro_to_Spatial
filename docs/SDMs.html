<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Species Distribution Models</title>

<script src="site_libs/header-attrs-2.14/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="Making_a_map.html">Making a map</a>
</li>
<li>
  <a href="NDVI_time_series.html">NDVI time series</a>
</li>
<li>
  <a href="Land_cover_change.html">Land cover change</a>
</li>
<li>
  <a href="SDMs.html">SDMs</a>
</li>
<li>
  <a href="Extras.html">Extras</a>
</li>
<li>
  <a href="Resources.html">Additional Resources</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Species Distribution Models</h1>

</div>


<p>Note: thank you to Geethen Singh for an earlier version of this
practical.</p>
<div id="learning-objectives" class="section level3">
<h3>Learning objectives</h3>
</div>
<div id="introduction" class="section level3">
<h3>Introduction</h3>
</div>
<div id="tutorial" class="section level3">
<h3>Tutorial</h3>
<pre class="r"><code>#### Install.packages ----
# install.packages(&#39;raster&#39;)
# install.packages(&#39;remotes&#39;)
# devtools::install_github(&quot;sjevelazco/flexsdm&quot;)
# Select 3 and then No
# install.packages(&#39;corrplot&#39;)
# install.packages(&#39;blockCV&#39;)
# install.packages(&#39;SDMtune&#39;)

#### Load libraries ----
library(terra) # raster manipulation</code></pre>
<pre><code>## terra 1.5.21</code></pre>
<pre class="r"><code>library(rnaturalearth) # country boundaries
library(tidyverse) # data manipulation and plotting</code></pre>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──</code></pre>
<pre><code>## ✔ ggplot2 3.3.6     ✔ purrr   0.3.4
## ✔ tibble  3.1.7     ✔ dplyr   1.0.9
## ✔ tidyr   1.2.0     ✔ stringr 1.4.0
## ✔ readr   2.1.2     ✔ forcats 0.5.1</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ ggplot2::arrow() masks terra::arrow()
## ✖ tidyr::extract() masks terra::extract()
## ✖ dplyr::filter()  masks stats::filter()
## ✖ dplyr::lag()     masks stats::lag()
## ✖ dplyr::src()     masks terra::src()</code></pre>
<pre class="r"><code>library(corrplot) # correlation plots</code></pre>
<pre><code>## corrplot 0.92 loaded</code></pre>
<pre class="r"><code>library(blockCV) # spatial block for cross-validation
library(sf) # vector manipulation</code></pre>
<pre><code>## Linking to GEOS 3.10.2, GDAL 3.4.2, PROJ 8.2.1; sf_use_s2() is TRUE</code></pre>
<pre class="r"><code>library(flexsdm) # SDM package
library(SDMtune) # SDM package</code></pre>
<pre><code>## 
##    _____  ____   __  ___ __
##   / ___/ / __ \ /  |/  // /_ __  __ ____   ___
##   \__ \ / / / // /|_/ // __// / / // __ \ / _ \
##  ___/ // /_/ // /  / // /_ / /_/ // / / //  __/
## /____//_____//_/  /_/ \__/ \__,_//_/ /_/ \___/  version 1.1.5
## 
## To cite this package in publications type: citation(&quot;SDMtune&quot;).</code></pre>
<pre class="r"><code>library(patchwork) # combine ggplots</code></pre>
<pre><code>## 
## Attaching package: &#39;patchwork&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:terra&#39;:
## 
##     area</code></pre>
<div id="load-in-data" class="section level4">
<h4>Load in data</h4>
<pre class="r"><code>#### Load in data ----
# Read species data 
protea &lt;- vect(&quot;output/files/making_a_map/p_roup_gbif.shp&quot;)
# download and load SA boundary
sern_a &lt;- ne_countries(scale = &#39;medium&#39;, country = c(&#39;South Africa&#39;, &#39;Lesotho&#39;, &#39;Swaziland&#39;), returnclass = &#39;sf&#39;)
# dissolve to outer boundary
sern_a %&gt;% group_by(level) %&gt;% summarise() %&gt;% vect() -&gt; sern_a_dissolve
# Download bioclim data
# r &lt;- rast(raster::getData(&quot;worldclim&quot;,var=&quot;bio&quot;,res=5))
# returns 19 variables
# or alternatively load from disk
r &lt;- rast(&quot;data/sdm/worldclim.tif&quot;)</code></pre>
<pre class="r"><code>#### Visualise raw data ----
plot(r[[1]])
plot(sern_a_dissolve, add = T)
plot(protea, add=T)</code></pre>
<p><img src="SDMs_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<pre class="r"><code>#### Edit extent of Sern A vector 
plot(sern_a_dissolve)</code></pre>
<p><img src="SDMs_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<pre class="r"><code>sern_a_dissolve &lt;- crop(sern_a_dissolve, ext(15, 33, -35, -20))
plot(sern_a_dissolve)</code></pre>
<p><img src="SDMs_files/figure-html/unnamed-chunk-4-2.png" width="672" /></p>
<pre class="r"><code>#### Check projections ----
crs(r) == crs(protea)</code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="r"><code>crs(r) == crs(sern_a_dissolve)</code></pre>
<pre><code>## [1] FALSE</code></pre>
<pre class="r"><code>sern_a_dissolve &lt;- project(sern_a_dissolve, r)
protea &lt;- project(protea, r)
crs(r) == crs(sern_a_dissolve)</code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="r"><code>crs(r) == crs(protea)</code></pre>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="calibration-area" class="section level4">
<h4>Calibration area</h4>
<pre class="r"><code>#### Calibration area ----
# Create a 150km buffer around our species points to create a prediction region
ca_protea &lt;- calib_area(data = as.data.frame(protea),
                        x = &#39;lon&#39;, y = &#39;lat&#39;,
                        method = c(&#39;buffer&#39;, width = 150000),
                        crs = crs(protea))

# Plot it out to see if this works
par(mfrow = c(1,1))
plot(ca_protea)
plot(protea, add = TRUE)</code></pre>
<p><img src="SDMs_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<pre class="r"><code># Intersect this with our country boundary to remove areas in the ocean
aoi &lt;- terra::intersect(ca_protea, sern_a_dissolve)
plot(ca_protea)
plot(aoi, col = &#39;red&#39;, add = TRUE)
plot(protea, add = TRUE)</code></pre>
<p><img src="SDMs_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
<div id="process-the-covariate-data" class="section level4">
<h4>Process the covariate data</h4>
<pre class="r"><code># Mask the covariates to the area of interest
covariates &lt;- mask(crop(r, aoi), aoi)
plot(covariates[[1]])
plot(aoi, add = TRUE)</code></pre>
<p><img src="SDMs_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<pre class="r"><code># rename the worldclim bands to more reasonable names
names(covariates)</code></pre>
<pre><code>##  [1] &quot;bio1&quot;  &quot;bio2&quot;  &quot;bio3&quot;  &quot;bio4&quot;  &quot;bio5&quot;  &quot;bio6&quot;  &quot;bio7&quot;  &quot;bio8&quot;  &quot;bio9&quot; 
## [10] &quot;bio10&quot; &quot;bio11&quot; &quot;bio12&quot; &quot;bio13&quot; &quot;bio14&quot; &quot;bio15&quot; &quot;bio16&quot; &quot;bio17&quot; &quot;bio18&quot;
## [19] &quot;bio19&quot;</code></pre>
<pre class="r"><code>names(covariates) &lt;- c(&quot;mean_ann_t&quot;,&quot;mean_diurnal_t_range&quot;,&quot;isothermality&quot;, &quot;t_seas&quot;, &#39;max_t_warm_m&#39;,&#39;min_t_cold_m&#39;,&quot;t_ann_range&quot;,&#39;mean_t_wet_q&#39;,&#39;mean_t_dry_q&#39;,&#39;mean_t_warm_q&#39;,&#39;mean_t_cold_q&#39;,&#39;ann_p&#39;, &#39;p_wet_m&#39;,&#39;p_dry_m&#39;,&#39;p_seas&#39;,&#39;p_wet_q&#39;,&#39;p_dry_q&#39;,&#39;p_warm_q&#39;,&#39;p_cold_q&#39;)
names(covariates)</code></pre>
<pre><code>##  [1] &quot;mean_ann_t&quot;           &quot;mean_diurnal_t_range&quot; &quot;isothermality&quot;       
##  [4] &quot;t_seas&quot;               &quot;max_t_warm_m&quot;         &quot;min_t_cold_m&quot;        
##  [7] &quot;t_ann_range&quot;          &quot;mean_t_wet_q&quot;         &quot;mean_t_dry_q&quot;        
## [10] &quot;mean_t_warm_q&quot;        &quot;mean_t_cold_q&quot;        &quot;ann_p&quot;               
## [13] &quot;p_wet_m&quot;              &quot;p_dry_m&quot;              &quot;p_seas&quot;              
## [16] &quot;p_wet_q&quot;              &quot;p_dry_q&quot;              &quot;p_warm_q&quot;            
## [19] &quot;p_cold_q&quot;</code></pre>
<pre class="r"><code># Re-scale temperature values
covariates[[c(1:2,5:11)]] &lt;- covariates[[c(1:2,5:11)]]/10
covariates[[3:4]] &lt;- covariates[[3:4]]/100</code></pre>
</div>
<div id="check-for-colinearity" class="section level4">
<h4>Check for colinearity</h4>
<pre class="r"><code># Using Pearson correlation
cov_colin &lt;- correct_colinvar(covariates, method = c(&#39;pearson&#39;, th = &quot;0.7&quot;))
# Take a look at the correlations using corrplot
pdf(&#39;output/figs/SDM/corr_plot.pdf&#39;, width = 8, height = 6)
corrplot(cov_colin$cor_table, tl.cex = 0.6)
dev.off()</code></pre>
<pre><code>## quartz_off_screen 
##                 2</code></pre>
<pre class="r"><code># Show which variables are correlated
cov_colin$cor_variables</code></pre>
<pre><code>## $mean_ann_t
## [1] &quot;max_t_warm_m&quot;  &quot;min_t_cold_m&quot;  &quot;mean_t_wet_q&quot;  &quot;mean_t_dry_q&quot; 
## [5] &quot;mean_t_warm_q&quot; &quot;mean_t_cold_q&quot;
## 
## $mean_diurnal_t_range
## [1] &quot;t_seas&quot;      &quot;t_ann_range&quot; &quot;p_dry_m&quot;     &quot;p_dry_q&quot;     &quot;p_cold_q&quot;   
## 
## $isothermality
## character(0)
## 
## $t_seas
## [1] &quot;mean_diurnal_t_range&quot; &quot;min_t_cold_m&quot;         &quot;t_ann_range&quot;         
## 
## $max_t_warm_m
## [1] &quot;mean_ann_t&quot;    &quot;mean_t_wet_q&quot;  &quot;mean_t_dry_q&quot;  &quot;mean_t_warm_q&quot;
## [5] &quot;mean_t_cold_q&quot;
## 
## $min_t_cold_m
## [1] &quot;mean_ann_t&quot;    &quot;t_seas&quot;        &quot;t_ann_range&quot;   &quot;mean_t_wet_q&quot; 
## [5] &quot;mean_t_dry_q&quot;  &quot;mean_t_warm_q&quot; &quot;mean_t_cold_q&quot;
## 
## $t_ann_range
## [1] &quot;mean_diurnal_t_range&quot; &quot;t_seas&quot;               &quot;min_t_cold_m&quot;        
## 
## $mean_t_wet_q
## [1] &quot;mean_ann_t&quot;    &quot;max_t_warm_m&quot;  &quot;min_t_cold_m&quot;  &quot;mean_t_dry_q&quot; 
## [5] &quot;mean_t_warm_q&quot; &quot;mean_t_cold_q&quot;
## 
## $mean_t_dry_q
## [1] &quot;mean_ann_t&quot;    &quot;max_t_warm_m&quot;  &quot;min_t_cold_m&quot;  &quot;mean_t_wet_q&quot; 
## [5] &quot;mean_t_warm_q&quot; &quot;mean_t_cold_q&quot;
## 
## $mean_t_warm_q
## [1] &quot;mean_ann_t&quot;    &quot;max_t_warm_m&quot;  &quot;min_t_cold_m&quot;  &quot;mean_t_wet_q&quot; 
## [5] &quot;mean_t_dry_q&quot;  &quot;mean_t_cold_q&quot;
## 
## $mean_t_cold_q
## [1] &quot;mean_ann_t&quot;    &quot;max_t_warm_m&quot;  &quot;min_t_cold_m&quot;  &quot;mean_t_wet_q&quot; 
## [5] &quot;mean_t_dry_q&quot;  &quot;mean_t_warm_q&quot;
## 
## $ann_p
## [1] &quot;p_wet_m&quot;  &quot;p_dry_m&quot;  &quot;p_wet_q&quot;  &quot;p_dry_q&quot;  &quot;p_warm_q&quot; &quot;p_cold_q&quot;
## 
## $p_wet_m
## [1] &quot;ann_p&quot;    &quot;p_wet_q&quot;  &quot;p_warm_q&quot;
## 
## $p_dry_m
## [1] &quot;mean_diurnal_t_range&quot; &quot;ann_p&quot;                &quot;p_seas&quot;              
## [4] &quot;p_dry_q&quot;              &quot;p_cold_q&quot;            
## 
## $p_seas
## [1] &quot;p_dry_m&quot;  &quot;p_dry_q&quot;  &quot;p_cold_q&quot;
## 
## $p_wet_q
## [1] &quot;ann_p&quot;    &quot;p_wet_m&quot;  &quot;p_warm_q&quot;
## 
## $p_dry_q
## [1] &quot;mean_diurnal_t_range&quot; &quot;ann_p&quot;                &quot;p_dry_m&quot;             
## [4] &quot;p_seas&quot;               &quot;p_cold_q&quot;            
## 
## $p_warm_q
## [1] &quot;ann_p&quot;   &quot;p_wet_m&quot; &quot;p_wet_q&quot;
## 
## $p_cold_q
## [1] &quot;mean_diurnal_t_range&quot; &quot;ann_p&quot;                &quot;p_dry_m&quot;             
## [4] &quot;p_seas&quot;               &quot;p_dry_q&quot;</code></pre>
<pre class="r"><code># Select the subset we want
selected_vars &lt;- c(&#39;min_t_cold_m&#39;, &#39;max_t_warm_m&#39;,&#39;isothermality&#39;,&#39;ann_p&#39;,&#39;p_seas&#39;)

# Subset the covariate data
cov_clean &lt;- covariates[[selected_vars]]
cov_clean</code></pre>
<pre><code>## class       : SpatRaster 
## dimensions  : 127, 81, 5  (nrow, ncol, nlyr)
## resolution  : 0.08333333, 0.08333333  (x, y)
## extent      : 26, 32.75, -32.75, -22.16667  (xmin, xmax, ymin, ymax)
## coord. ref. : lon/lat WGS 84 (EPSG:4326) 
## sources     : memory  
##               memory  
##               memory  
##               ... and 1 more source(s)
## names       : min_t_cold_m, max_t_warm_m, isothermality,   ann_p,  p_seas 
## min values  :        -5.70,        14.60,          0.49,  320.00,   25.00 
## max values  :        13.10,        35.00,          0.65, 1390.00,   95.00</code></pre>
</div>
<div id="presence-filtering" class="section level4">
<h4>Presence filtering</h4>
<pre class="r"><code># select only the lon/lat and provide a unique ID to each row
protea_df &lt;- as.data.frame(protea) %&gt;% select(lon, lat)
protea_df$id &lt;- 1:nrow(protea_df)

# Run a filter on presence values based on the similarity in values of the environmental covariates
occ_filt_10bin &lt;- occfilt_env(
  data = protea_df,
  x = &#39;lon&#39;,
  y = &#39;lat&#39;,
  id = &#39;id&#39;,
  env_layer = cov_clean,
  nbins = 10 # run ?occfilt_env to find out more on the method
)</code></pre>
<pre><code>## Extracting values from raster ...</code></pre>
<pre><code>## Number of unfiltered records: 244</code></pre>
<pre><code>## Number of filtered records: 103</code></pre>
<pre class="r"><code># This removes ~120 records and only keeps ~100 records due to similarity!

# Plot our old points and new filtered points
par(mfrow = c(1,1))
plot(cov_clean[[1]]); 
points(protea_df, pch = 19, cex = 0.3);
points(occ_filt_10bin[,2:3], pch = 19, cex = 0.3, col = &#39;red&#39;)</code></pre>
<p><img src="SDMs_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<pre class="r"><code># most of the filtering is happening where the points are spatially clustered...</code></pre>
<pre class="r"><code># Save the 10 bin environmental filtering
protea_filt_pres &lt;- occ_filt_10bin[,2:3]

# Assign 1 to represent presence
protea_filt_pres$pr_ab &lt;- 1</code></pre>
</div>
<div id="spatial-block-cross-validation" class="section level4">
<h4>Spatial block cross-validation</h4>
<pre class="r"><code># We now want to partition our data into different spatial blocks or &quot;folds&quot; to avoid spatial autocorrelation
# find the range value of block sizes by fitting variograms to each environmental raster to find the effective range of spatial autocorrelation
spat_range &lt;- spatialAutoRange(
  rasterLayer = raster::raster(cov_clean),
  speciesData = st_as_sf(protea_filt_pres, coords = c(&#39;lon&#39;,&#39;lat&#39;), crs = crs(cov_clean)),
  doParallel = TRUE,
  showPlots = TRUE)</code></pre>
<pre><code>## Loading required namespace: rgeos</code></pre>
<p><img src="SDMs_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<pre class="r"><code># This suggest ~110km as an appropriate size for our blocks</code></pre>
<pre class="r"><code># We can now create our spatial folds (k) for later cross-validation
# set the random seed, so this the output is the same across machines
spat_blocks1 &lt;- spatialBlock(
  speciesData = st_as_sf(protea_filt_pres, coords = c(&#39;lon&#39;,&#39;lat&#39;), crs = crs(cov_clean)),
  species = &quot;pr_ab&quot;,
  rasterLayer = raster::raster(cov_clean),
  k = 4,
  theRange = 110469,
  border = st_as_sf(aoi),
  seed = 101
)</code></pre>
<pre><code>## Warning: attribute variables are assumed to be spatially constant throughout all
## geometries</code></pre>
<pre><code>## The best folds was in iteration 32:
##   train_1 test_1
## 1      78     25
## 2      77     26
## 3      77     26
## 4      77     26</code></pre>
<pre><code>## Warning: `guides(&lt;scale&gt; = FALSE)` is deprecated. Please use `guides(&lt;scale&gt; =
## &quot;none&quot;)` instead.</code></pre>
<pre><code>## Warning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not
## give correct results for longitude/latitude data</code></pre>
<p><img src="SDMs_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<pre class="r"><code>ggsave(&#39;output/figs/SDM/spatial_block.png&#39;,
       width = 6, height = 5, dpi = &#39;retina&#39;, bg = &#39;white&#39;)</code></pre>
<pre><code>## Warning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not
## give correct results for longitude/latitude data</code></pre>
<pre class="r"><code># Assign the folds (or partitions) back onto the presence dataset
protea_filt_pres$folds &lt;- spat_blocks1$foldID
# Each point is now assigned to 1 of 4 partitions
head(protea_filt_pres)</code></pre>
<pre><code>## # A tibble: 6 × 4
##     lon   lat pr_ab folds
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
## 1  28.7 -30.2     1     3
## 2  28.2 -30.8     1     3
## 3  27.8 -26.1     1     3
## 4  29.4 -29.6     1     2
## 5  28.8 -30.4     1     3
## 6  30.9 -24.7     1     4</code></pre>
<pre class="r"><code># count the number of presences in each fold
protea_filt_pres %&gt;% group_by(folds) %&gt;% count()</code></pre>
<pre><code>## # A tibble: 4 × 2
## # Groups:   folds [4]
##   folds     n
##   &lt;int&gt; &lt;int&gt;
## 1     1    25
## 2     2    26
## 3     3    26
## 4     4    26</code></pre>
<pre class="r"><code># Rasterize the blocks
grid_env &lt;- rasterize(vect(spat_blocks1$blocks), cov_clean, field = &#39;folds&#39;)</code></pre>
<pre><code>## Warning: [vect] argument &#39;crs&#39; should be a character value</code></pre>
<pre class="r"><code>plot(grid_env)</code></pre>
<p><img src="SDMs_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
</div>
<div id="create-pseudo-absences" class="section level4">
<h4>Create pseudo-absences</h4>
<pre class="r"><code># We can now create our pseudo-absences and make sure they are evenly spaced across each of our fold grids, based on the number of presence points we have in each fold
# We can also make sure that they are placed away from our presence points by a environmental or distance buffer - here we use a 20 km distance buffer
# pseudo-absences
pa &lt;- lapply(1:4, function(x) {
  sample_pseudoabs(
  data = protea_filt_pres,
  x = &#39;lon&#39;,
  y = &#39;lat&#39;,
  n = sum(protea_filt_pres$folds == x),
  # method = c(&#39;env_const&#39;, env = cov_clean), # constrain to env less suitable places based on bioclim model of protea presences
  # method = &#39;random&#39;,
  method = c(&#39;geo_const&#39;, width = 20000),
  maskval = x,
  rlayer = grid_env,
  calibarea = aoi
)
}) %&gt;% bind_rows() </code></pre>
<pre class="r"><code># Extract the partition number for each pseudo-absence point
pa &lt;- sdm_extract(data = pa, x = &quot;lon&quot;, y = &quot;lat&quot;, env_layer = grid_env)
head(pa)</code></pre>
<pre><code>## # A tibble: 6 × 4
##     lon   lat pr_ab folds
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  30.2 -30.6     0     1
## 2  30.6 -30.3     0     1
## 3  31.7 -26.5     0     1
## 4  31.3 -26.4     0     1
## 5  30.9 -26.5     0     1
## 6  31.2 -27.4     0     1</code></pre>
<pre class="r"><code># Count the number of pseudo-absence &amp; presence points in each fold and see if they are equal
pa %&gt;% group_by(folds) %&gt;% count() == protea_filt_pres %&gt;% group_by(folds) %&gt;% count()</code></pre>
<pre><code>##      folds    n
## [1,]  TRUE TRUE
## [2,]  TRUE TRUE
## [3,]  TRUE TRUE
## [4,]  TRUE TRUE</code></pre>
<pre class="r"><code>#### Let&#39;s plot the presences and pseudo-absences and view which folds they fall into
ggplot() +
  geom_sf(data = st_as_sf(aoi), fill = NA) +
  geom_sf(data = st_as_sf(spat_blocks1$blocks)) +
  geom_point(data = rbind(protea_filt_pres, pa), aes(x = lon, y = lat, col = as.factor(folds), pch = as.factor(pr_ab))) +
  labs(colour = &#39;Folds&#39;, shape = &#39;Presence/\nPseudo-absence&#39;) +
  theme_void()</code></pre>
<p><img src="SDMs_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<pre class="r"><code>ggsave(&#39;output/figs/SDM/folds_and_points.png&#39;,
       width = 6, height = 5, dpi = &#39;retina&#39;, bg = &#39;white&#39;)</code></pre>
</div>
<div id="extract-covariate-values-for-each-point"
class="section level4">
<h4>Extract covariate values for each point</h4>
<pre class="r"><code># Prepare a SWD (Sample with Data), which is a class of data specifically used in the SDMtune package
SWDdata &lt;- prepareSWD(
  species = &#39;Protea roupelliae&#39;,
  p = protea_filt_pres[,1:2],
  a = pa[,1:2],
  env = cov_clean
)</code></pre>
<pre><code>## Extracting predictor information for presence locations...</code></pre>
<pre><code>## Extracting predictor information for absence/background locations...</code></pre>
<pre class="r"><code>head(SWDdata@data)</code></pre>
<pre><code>##   ID min_t_cold_m max_t_warm_m isothermality ann_p p_seas
## 1  1          0.9         24.8          0.55   743     69
## 2  2         -1.1         24.3          0.53   767     59
## 3  3          1.6         27.1          0.55   712     74
## 4  4         -3.0         22.4          0.52  1031     75
## 5  5          1.7         24.8          0.58   793     67
## 6  6          5.1         24.3          0.64  1010     77</code></pre>
<pre class="r"><code># For some reason ID is included, so we need to remove this...
SWDdata@data &lt;- SWDdata@data[-1]</code></pre>
</div>
<div id="fit-the-model" class="section level4">
<h4>Fit the model</h4>
</div>
<div id="randomforest-with-random-folds" class="section level4">
<h4>RandomForest with random folds</h4>
<pre class="r"><code># We can now fit our models! Let&#39;s first create random folds so that we can compare the output with the spatial blocking folds
rand_folds &lt;- randomFolds(SWDdata, k = 4, only_presence = TRUE, seed = 1)

# Run a RandomForest model with default setting and random folds
set.seed(1)
rf_randcv &lt;- train(method = &#39;RF&#39;, data = SWDdata, folds = rand_folds)</code></pre>
<pre class="r"><code># Check the overall AUC and TSS values
paste0(&#39;Testing AUC: &#39;, round(SDMtune::auc(rf_randcv, test = TRUE),2))</code></pre>
<pre><code>## [1] &quot;Testing AUC: 0.97&quot;</code></pre>
<pre class="r"><code>paste0(&#39;Testing TSS: &#39;, round(SDMtune::tss(rf_randcv, test = TRUE),2))</code></pre>
<pre><code>## [1] &quot;Testing TSS: 0.84&quot;</code></pre>
<div id="randomforest-with-spatial-folds" class="section level5">
<h5>RandomForest with spatial folds</h5>
<pre class="r"><code># Our initial spatial blocking did not include the pseudo-absence data, so let&#39;s re-run the spatialBlock function to include both presence (1) and pseudo-absences (0)
# we can now use our previously predefined blocks
spat_blocks2 &lt;- spatialBlock(speciesData = st_as_sf(bind_rows(protea_filt_pres, pa), coords = c(&#39;lon&#39;,&#39;lat&#39;), crs = crs(cov_clean)), 
                   species = &quot;pr_ab&quot;,
                   rasterLayer = raster::raster(cov_clean)[[1]], 
                   selection = &#39;predefined&#39;,
                   k = 4,
                   blocks = spat_blocks1$blocks,
                   foldsCol = &quot;folds&quot;,
                   seed = 101) </code></pre>
<pre><code>##   train_0 train_1 test_0 test_1
## 1      78      78     25     25
## 2      77      77     26     26
## 3      77      77     26     26
## 4      77      77     26     26</code></pre>
<pre><code>## Warning: `guides(&lt;scale&gt; = FALSE)` is deprecated. Please use `guides(&lt;scale&gt; =
## &quot;none&quot;)` instead.</code></pre>
<pre><code>## Warning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not
## give correct results for longitude/latitude data</code></pre>
<p><img src="SDMs_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<pre class="r"><code># View the output
spat_blocks2$folds</code></pre>
<pre><code>## [[1]]
## [[1]][[1]]
##   [1] 199 190 189  36 184 192  24 205 200 194  56 203 204 193 195 188  74 134
##  [19]  75 147  71 135 141  52 152 144  81  78  44 137 131 133 146 132 150  41
##  [37] 182 183 181 187 186 206   6 198 197 196 169  15 166 179 164 177  37 172
##  [55] 162 175 168 178  94  80  27  61  59  13  91  38  10  97  96   9  62  25
##  [73]  51  55 165 163  90  66  58  76  23   3 171 180  11 176 157  77 185  98
##  [91]  82 202 142 149  48  68 143 138 136 154 151  49  28 201 191 101  54  18
## [109]  84  22  20  16   4  30  83 153  42   8  73  86  64  85 174 155  89  29
## [127]  14 158 159  35   1   2  47 167   5  46  45 100  79 156 139  43 129 130
## [145] 148   7 140 145  40 173 170 161 160  57  39 102
## 
## [[1]][[2]]
##  [1] 111  53  12 112  31  70  19  99 107  69 118 108 124 116  17 123 106 109 128
## [20] 122  60  67 119 120 110  95  93  92  26  34  32 125 103  87  33 115  63  21
## [39] 126 127 113  88  65 114  72 104 105 117 121  50
## 
## 
## [[2]]
## [[2]][[1]]
##   [1] 199 190 189  36 184 192  24 205 200 194  56 203 204 193 195 188  74 111
##  [19]  53  12 112  31  70  19  99 182 183 181 187 186 206   6 198 197 196 169
##  [37]  15 166 179 164 177  37 172 162 175 168 178  94  80  27  61  59  13  91
##  [55]  38  10  97  96   9  62  25  51  55 165 163  90  66  58  76  23   3 171
##  [73] 180  11 176 157  77 185  98  82 202 107  69 118 108 124 116  17 123 106
##  [91] 109 128 122  60  67 119 120 110  28 201 191 101  95  93  92  26  34  32
## [109] 125 103  87  33 115  63  21 126 127 113  85 174 155  89  29  14 158 159
## [127]  35   1   2  47 167   5  46  45 100  79 156  88  65 114  72 104 105 117
## [145] 121  50  40 173 170 161 160  57  39 102
## 
## [[2]][[2]]
##  [1] 134  75 147  71 135 141  52 152 144  81  78  44 137 131 133 146 132 150  41
## [20] 142 149  48  68 143 138 136 154 151  49  54  18  84  22  20  16   4  30  83
## [39] 153  42   8  73  86  64 139  43 129 130 148   7 140 145
## 
## 
## [[3]]
## [[3]][[1]]
##   [1] 199 190 189  36 184 192  24 205 200 194  56 203 204 193 195 188  74 134
##  [19]  75 147  71 135 141  52 152 144  81  78  44 137 131 133 146 132 150  41
##  [37] 111  53  12 112  31  70  19  99 182 183 181 187 186 206   6 198 197 196
##  [55]  94  80  27  61  59  13  91  38  10  97  96   9  62  25  51 185  98  82
##  [73] 202 107  69 118 108 124 116  17 123 106 142 149  48  68 143 138 136 154
##  [91] 151  49 109 128 122  60  67 119 120 110  28 201 191 101  95  93  92  26
## [109]  34  32 125 103  87  33 115  63  21 126 127 113  54  18  84  22  20  16
## [127]   4  30  83 153  42   8  73  86  64  88  65 114  72 104 105 117 121  50
## [145] 139  43 129 130 148   7 140 145  39 102
## 
## [[3]][[2]]
##  [1] 169  15 166 179 164 177  37 172 162 175 168 178  55 165 163  90  66  58  76
## [20]  23   3 171 180  11 176 157  77  85 174 155  89  29  14 158 159  35   1   2
## [39]  47 167   5  46  45 100  79 156  40 173 170 161 160  57
## 
## 
## [[4]]
## [[4]][[1]]
##   [1] 134  75 147  71 135 141  52 152 144  81  78  44 137 131 133 146 132 150
##  [19]  41 111  53  12 112  31  70  19  99 169  15 166 179 164 177  37 172 162
##  [37] 175 168 178  55 165 163  90  66  58  76  23   3 171 180  11 176 157  77
##  [55] 107  69 118 108 124 116  17 123 106 142 149  48  68 143 138 136 154 151
##  [73]  49 109 128 122  60  67 119 120 110  95  93  92  26  34  32 125 103  87
##  [91]  33 115  63  21 126 127 113  54  18  84  22  20  16   4  30  83 153  42
## [109]   8  73  86  64  85 174 155  89  29  14 158 159  35   1   2  47 167   5
## [127]  46  45 100  79 156  88  65 114  72 104 105 117 121  50 139  43 129 130
## [145] 148   7 140 145  40 173 170 161 160  57
## 
## [[4]][[2]]
##  [1] 199 190 189  36 184 192  24 205 200 194  56 203 204 193 195 188  74 182 183
## [20] 181 187 186 206   6 198 197 196  94  80  27  61  59  13  91  38  10  97  96
## [39]   9  62  25  51 185  98  82 202  28 201 191 101  39 102</code></pre>
<p>As we can see, we have 4 folds In each of these we have our training
data [[1]] and our testing data [[2]]. Also, as you can see from the
console output, the training/testing split is approximately 70%
training, 30% testing.</p>
<pre class="r"><code># Run a RandomForest model with default setting and spatial folds
set.seed(1)
rf_sbcv &lt;- train(method = &#39;RF&#39;, data = SWDdata, folds = spat_blocks2)</code></pre>
<pre class="r"><code># Check the overall AUC and TSS values
paste0(&#39;Testing AUC: &#39;, round(SDMtune::auc(rf_sbcv, test = TRUE),2))</code></pre>
<pre><code>## [1] &quot;Testing AUC: 0.78&quot;</code></pre>
<pre class="r"><code>paste0(&#39;Testing TSS: &#39;, round(SDMtune::tss(rf_sbcv, test = TRUE),2))</code></pre>
<pre><code>## [1] &quot;Testing TSS: 0.55&quot;</code></pre>
<pre class="r"><code># Extract the ROC curve and AUC values for each model
source(&#39;scripts/functions/extract_roc_vals.R&#39;)</code></pre>
<pre><code>## Loading required package: pROC</code></pre>
<pre><code>## Type &#39;citation(&quot;pROC&quot;)&#39; for a citation.</code></pre>
<pre><code>## 
## Attaching package: &#39;pROC&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:SDMtune&#39;:
## 
##     auc</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     cov, smooth, var</code></pre>
<pre class="r"><code>spec_sens_vals &lt;- extract_spec_sens_vals(rf_sbcv, spat_blocks2, SWDdata)</code></pre>
<pre><code>## Setting levels: control = 0, case = 1</code></pre>
<pre><code>## Setting direction: controls &lt; cases</code></pre>
<pre><code>## Setting levels: control = 0, case = 1</code></pre>
<pre><code>## Setting direction: controls &lt; cases</code></pre>
<pre><code>## Setting levels: control = 0, case = 1</code></pre>
<pre><code>## Setting direction: controls &lt; cases</code></pre>
<pre><code>## Setting levels: control = 0, case = 1</code></pre>
<pre><code>## Setting direction: controls &lt; cases</code></pre>
<pre class="r"><code>auc_vals &lt;- extract_auc_vals(rf_sbcv, spat_blocks2, SWDdata)</code></pre>
<pre><code>## Setting levels: control = 0, case = 1
## Setting direction: controls &lt; cases</code></pre>
<pre><code>## Setting levels: control = 0, case = 1</code></pre>
<pre><code>## Setting direction: controls &lt; cases</code></pre>
<pre><code>## Setting levels: control = 0, case = 1</code></pre>
<pre><code>## Setting direction: controls &lt; cases</code></pre>
<pre><code>## Setting levels: control = 0, case = 1</code></pre>
<pre><code>## Setting direction: controls &lt; cases</code></pre>
<pre class="r"><code>auc_vals$label &lt;- paste0(auc_vals$model_no, &quot;: &quot;, round(auc_vals$auc,2))</code></pre>
<pre class="r"><code># ROC curves with AUC values for each model 
ggplot(data = spec_sens_vals) +
  geom_abline(aes(slope = 1, intercept = 0), lty = 2) +
  geom_path(aes(x = 1- specificities, y = sensitivities, group = model_no, col = as.factor(model_no)), alpha = 0.8) +
  scale_colour_viridis_d(name = &#39;Model no. &amp; AUC&#39;,
                         labels = auc_vals$label) +
  labs(x = &#39;False Positive Rate&#39;, y = &#39;True Positive Rate&#39;) +
  geom_text(aes(x = 0.15, y = 0.95), label = paste0(&#39;Overall testing AUC: &#39;, round(SDMtune::auc(rf_sbcv, test = TRUE),2)), size = 3) +
  theme_bw() +
  theme(panel.grid = element_blank(),
        legend.position = c(0.8, 0.25),
        legend.title = element_text(size = 8),
        legend.text = element_text(size = 7))</code></pre>
<p><img src="SDMs_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<pre class="r"><code>ggsave(&#39;output/figs/SDM/rf_sbcv_auc_plot.png&#39;,
       width = 6, height = 5, dpi = &#39;retina&#39;, bg = &#39;white&#39;)</code></pre>
</div>
</div>
<div id="variable-importance" class="section level4">
<h4>Variable importance</h4>
<pre class="r"><code># VI for the random fold RF model
vi_rf_randcv &lt;- varImp(rf_randcv)
plotVarImp(vi_rf_randcv)</code></pre>
<p><img src="SDMs_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<pre class="r"><code># VI for the spatial fold RF model
vi_rf_sbcv &lt;- varImp(rf_sbcv)
plotVarImp(vi_rf_sbcv)</code></pre>
<p><img src="SDMs_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<pre class="r"><code>ggsave(&#39;output/figs/SDM/rf_sbcv_vi.png&#39;,
       width = 6, height = 5, dpi = &#39;retina&#39;, bg = &#39;white&#39;)</code></pre>
</div>
<div id="response-curves" class="section level4">
<h4>Response curves</h4>
<pre class="r"><code>plotResponse(rf_sbcv, var = &quot;ann_p&quot;, marginal = TRUE, rug = TRUE) + labs(x = &#39;Ann. precip.&#39;) +
plotResponse(rf_sbcv, var = &quot;max_t_warm_m&quot;, marginal = TRUE, rug = TRUE) + labs(x = &#39;Max. temp. warmest month&#39;)</code></pre>
<p><img src="SDMs_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
<pre class="r"><code>ggsave(&#39;output/figs/SDM/rf_sbcv_response_curves.png&#39;,
       width = 8, height = 4, dpi = &#39;retina&#39;, bg = &#39;white&#39;)</code></pre>
</div>
<div id="model-prediction" class="section level4">
<h4>Model prediction</h4>
<p>We can now predict which areas appear most suitable to our target
species across our full area of interest using predict() and our
environmental layers.</p>
<pre class="r"><code>pred &lt;- predict(rf_sbcv, data = raster::stack(cov_clean))</code></pre>
<pre class="r"><code># using the SMDtune::plotPred can give us a nice quick map
plotPred(pred, lt = &quot;Habitat\nsuitability&quot;, colorramp = c(&quot;#2c7bb6&quot;, &quot;#abd9e9&quot;, &quot;#ffffbf&quot;, &quot;#fdae61&quot;, &quot;#d7191c&quot;))</code></pre>
<p><img src="SDMs_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
<pre class="r"><code># We can also customise this further in ggplot if we like
pred_df &lt;- as.data.frame(pred, xy = TRUE)

ggplot() +
  geom_sf(data = st_as_sf(sern_a), fill = &#39;white&#39;, col = NA) + 
  geom_tile(data = pred_df, aes(x = x, y = y, fill = layer, col = layer)) +
  scale_colour_viridis_c(na.value = NA, option = &#39;C&#39;, breaks = seq(0,1,0.25),limits = c(0,1)) +
  scale_fill_viridis_c(na.value = NA, option = &#39;C&#39;, breaks = seq(0,1,0.25),limits = c(0,1)) +
  geom_sf(data = st_as_sf(sern_a), fill = NA, col = &#39;black&#39;, lwd = 0.25) + 
  geom_sf(data = st_as_sf(protea_filt_pres, coords = c(&#39;lon&#39;, &#39;lat&#39;), crs = crs(sern_a)), size = 0.5, col = &#39;black&#39;, fill = &#39;white&#39;, pch = 21) +
  scale_x_continuous(limits = c(ext(cov_clean)[1], ext(cov_clean)[2]), breaks = seq(26,32,3)) + 
  scale_y_continuous(limits = c(ext(cov_clean)[3],ext(cov_clean)[4]), breaks = seq(-32,-22,5)) +
  labs(fill = &#39;Habitat\nsuitability&#39;, 
       col = &#39;Habitat\nsuitability&#39;,
       x = &#39;Longitude&#39;, y = &#39;Latitude&#39;) +
  theme_minimal() </code></pre>
<p><img src="SDMs_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
<pre class="r"><code>ggsave(&#39;output/figs/SDM/rf_sbcv_hab_suit.png&#39;,
       width = 6, height = 6, dpi = &#39;retina&#39;, bg = &#39;white&#39;)</code></pre>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
